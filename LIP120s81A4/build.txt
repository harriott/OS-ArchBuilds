vim: ft=build:

Lenovo IdeaPad 120s 81A4 = LIP120S-81A4 = LIP120s81A4

# before Dropbox, prepare K8GBDTIG3
cp -f $ITstack/unix_like-GNULinux/iwctl-connect.sh /run/media/jo/K8GBDTIG3
rsync -irtv --delete --modify-window=1 $onGH/ArchBuilds/ /run/media/jo/K8GBDTIG3/ArchBuilds
rsync -irtv --delete --modify-window=1 $core/ /run/media/jo/K8GBDTIG3/core
# build
## Arch install - from the ISO
### prepare the bootable disk
booted to  archlinux-2021.04.01-x86_64.iso  on  KDT100G3C
  Arch Linux install medium (x86_64, UEFI)
#### prepare the bootable disk
lsblk shows
  mmcblk0 29.1G divided into 4
  mmcblk0boot0 4M
  mmcblk0boot1 4M
gdisk /dev/mmcblk0 >
  (o (clear out all partition data) > y would've probably been enough)
  x (extra functionality) > z (Zap) > y > y
lsblk shows
  mmcblk0 29.1G
  mmcblk0boot0 4M
  mmcblk0boot1 4M
lsblk -f
#### check in Knoppix
halt -p
booted straight into Knoppix v9.1 on KDTG311281
Menu > Accessories > Disks  showed
  SD Card DF4032 31GB /dev/mmcblk0
  /dev/mmcblk0boot0 4.2MB Unkown
  /dev/mmcblk0boot1 4.2MB Unkown
PCManFM can see but not enter into the mmcblk0bootx's
#### proposal
/ on the 32GB eMMC except /home /usr on SDEP128G
### ARCH_202109 to chroot
booted to  archlinux-2021.09.01-x86_64.iso  on  K8GBDT100  in left USB socket
#### check booted to UEFI mode
ls /sys/firmware/efi/efivars  returns a load of files
#### create UEFI & root partitions
gdisk /dev/mmcblk0 >
  p
  o (create a new empty GUID partition table (GPT) > y
  p
  n > Partition number (defaults to 1) > First sector (defaults to 2048) > Last sector > +550m >
    ef00 (EFI system partition)
  n > Partition number (defaults to 2) > First sector (defaults to 1128448) > Enter >
    8304 Linux x86-64 root (/)
  w > y
gdisk /dev/mmcblk0 -l
#### add in forgotten swap
gdisk /dev/mmcblk0 >
  d > 2
  n > Partition number (defaults to 3) > First sector (defaults to the sector after partition 2) >
    +4g > 8200 (Linux swap)
  n > Partition number (defaults to 2) > First sector (defaults to 1128448) > Enter >
    8304 Linux x86-64 root (/)
  w > y
#### K8GBDTIG3
K8GBDTIG3 loaded with  ArchBuilds plugged into right USB socket
mkdir /bs   mount /dev/sdb /bs   cd /bs   bash iwctl-connect.sh
  ping -c 3 -n google.com
cd /bs/ArchBuilds/build-scripts
bash 01-as_root-efi-to_chroot.sh
##### to bootloader
###### K8GBDTIG3
mount /dev/sdc /mnt
  cd /mnt/ArchBuilds/build-scripts
bash 02-when_chroot-to_bootloader.sh
## reboot to root
root pw
dmesg | grep 'EFI v'  reported "EFI v2.50 by Phoenix Technologies Ltd"
### K8GBDTIG3
K8GBDTIG3 loaded with  ArchBuilds  plugged into right USB socket
mount /dev/sda /mnt   cd /mnt/ArchBuilds/build-scripts
Jo-X10II  tethered into left USB for  ip l  which indicated  dhcpcd enp0s21f0u2
pacman -S iwd
pacman -S git  for  bash 03-cloneArchBuilds.sh
### /ArchBuilds
bash 05-iwd-root_symlinks.sh
bash 08-as_root-to_headers.sh
#### to jo
bash 10-as_root-to_jo.sh
## reboot to jo
cd /home  for  sudo chown -R jo:jo jo  got "Operation not permitted"...
## fix /home
somehow  SDEP128G  (as mmcblk0p1)  got mounted as  /home  so  userdel -r jo
### create /home & /usr partitions on SDEP128G
wipefs /dev/mmcblk1  returned "dos"
mount /dev/mmcblk1p1  reports it to be mounted on /home  so
  umount /dev/mmcblk1  for  wipefs --all /dev/mmcblk1
gdisk /dev/mmcblk1 >
  o (create a new empty GUID partition table (GPT) > y
  n > Partition number (defaults to 1) > First sector (defaults to 2048) > Last sector > +20g >
    Enter > 8300
  d
  n > Partition number (defaults to 1) > First sector (defaults to 2048) > Last sector > +20g >
    8314 Linux x86-64 /usr
  n > Partition number (defaults to 2) > First sector (defaults to the sector after partition 2) >
    Enter > Enter > 8302 (Linux home)
  w > y
#### reboot into emergency mode
Dependency failed for /home
root pw
##### internet
iwctl  not working, so
  Jo-X10II  tethered into left USB for  ip l  which indicated  dhcpcd enp0s21f0u2
##### format SDEP128G
lsblk
mkfs.ext4 /dev/mmcblk0p1
mkfs.ext4 /dev/mmcblk0p2
##### fstab
blkid > blkid  for  nano /etc/fstab  then imported  blkid  and tweaked  /home
## reboot to jo
### jo nanorc
### K8GBDTIG3
K8GBDTIG3 loaded with  core  plugged into left USB socket
#### mount K8GBDTIG3 readable as jo
sudo mount -t exfat -o uid=1000,gid=1000 /dev/sdb1 /mnt
## reboot to root
### update /ArchBuilds
#### mount partition KDTG311282 containing  core
blkid indicates  mount /dev/sda2 /mnt
bash /mnt/core/IT_stack/unix_like-GNULinux/iwctl-connect.sh  got me online
cd /; bash ArchBuilds/build-scripts/03-cloneArchBuilds.sh; cd ArchBuilds/build-scripts
### rsyncBackup.sh
booted to  archlinux-2021.09.01-x86_64.iso  on  K8GBDT100  in left USB socket
KDTG311281 in right USB socket
blkid  indicates  mount /dev/sdb1 /mnt
### move /usr to mmcblk0p1 - fail
#### mkinitcpio_conf
reboot to root  for  bash 09-as_root-move_usr.sh
grep 'd f' /etc/mkinitcpio.conf
#### fstab
ls -l /dev/disk/by-uuid/ > /mnt/UUIDs.txt
cp /etc/fstab /mnt/fstab
#### copy over /usr
booted to  archlinux-2021.09.01-x86_64.iso  on  K8GBDT100  in left USB socket
mkdir /as
lsblk indicated  mount /dev/mmcblk1p3 /as
  mkdir /au  for  mount /dev/mmcblk0p1 /au
    ls /au  shows it contains  lost+found  so  rm -r /au lost+found
rsync -aAivX /as/usr/ /au
mv /as/usr /as/usrOld
#### reboot to root fails
ERROR: Root device mounted successfully, but /sbin/init does not exist.
### move /home back into /
nano /etc/fstab  to comment out  /home  reboot
lsblk  indicates  mount /dev/mmcblk1p2 /mnt
rsync -aAivX /mnt/ /home
### repartition SDEP128G
lsblk  indicates  wipefs /dev/mmcblk1  returned stuff, so
  wipefs --all /dev/mmcblk1
gdisk /dev/mmcblk1 >
  o (create a new empty GUID partition table (GPT) > y
  n > Partition number (defaults to 1) > First sector (defaults to 2048) > Enter > Enter > 8300
  w > y
### format SDEP128G
lsblk
mkfs.ext4 -L SDEP128G /dev/mmcblk1p1 > y
### tidy fstab
cp /mnt/fstab-l9r-4 /etc/fstab  then  reboot  to check it got stuck, so  hard off
reboot  worked
### automount SDEP128G
bash 11-as_root-extra_drives.sh
## Rootkit Hunter
as root  bash 12-as_root-RootkitHunt.sh
## to Firewall
as root  bash 14-as_root-when_jo-toFirewall.sh
freshclam  didn't complete, so  freshclam   which got me "Clamd was NOT notified"
  as root  bash 14-as_root-when_jo-toFirewall.sh
## configure freshclam
as root  bash 15-as_root-when_jo-configure_freshclam.sh
## to X
as root  bash 02-when_chroot-reflector.sh
as root  bash 16-as_root-when_jo-to_X.sh
bash 17-symlinks.sh
bash 18-misc.sh
bash remote2.sh
bash 19-git_ssh.sh
## get nvim working
bash 21-vimfiles.sh
## rsnapshot
bash 23-rsnapshot.sh
bash 24-as_root-rsnapshot_automated.sh
## configure jo
bash 25-configure_jo.sh
bash 26-tmux.sh
## Updates
:: Import PGP key 1736C918F59A5673, "Alexander Epaneshnikov <alex19ep@archlinux.org>"? [Y/n]
## prepare for Softwares
bash 27-prepare_forSoftwares.sh
### GnuPG keys
gpg --list-keys
  gpg: directory '/home/jo/.gnupg' created
  gpg: keybox '/home/jo/.gnupg/pubring.kbx' created
  gpg: /home/jo/.gnupg/trustdb.gpg: trustdb created
lsblk -l  indicated  sudo mount /dev/sdb1 /au
#### import 842A4DEE13F327EF
in  /au/secure/  gpg --import sprbMbArch-private.asc > passphrase
### password-store
lsblk -l  indicated  sudo mount /dev/sdb1 /au
in  /au/secure/  cp password-store ~/.password-store
## Zen kernel
bash 28-Zen.sh
## prepare for Openbox
su > root pw for  bash 29-as_root-toOpenbox.sh
bash 30-toOpenbox.sh
bash 31-symlinks-Openbox.sh
bash 32-resourceHandler.sh
## X
startx  reports that  /etc/X11/xinit/xserverrc  can't find  /usr/bin/X
  sudo pacman -S xorg-server
## handlr
bash 32-resourceHandler.sh
## nnn improvements
bash 33-softwares-for_nnn.sh
## NetworkManager Jo-XA2
nmcli device  reports  wlan0 disconnected
nmcli device wifi list | cat  shows  Jo-XA2
### activation failed
nmcli device wifi connect Jo-XA2 password <pw>
  Secrets were required, but not provided.
nmcli connection show
nmcli connection delete Jo-XA2
## NetworkManager Jo-X10II
nmcli device wifi list | cat  shows  Jo-XA10II
nmcli device wifi connect Jo-XA2 password <pw>  go me connected
## waiting
# physical configuration
F2 at boot for Phoenix SecureCore Technology Setup
KDTG311281  for  rsnapshot
lspci -k | grep 3165 -A 3
screen is 1366x768
SDEP128G in microSD slot
