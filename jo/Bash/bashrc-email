# vim: ft=sh:

# see  $email/msmtprc-template  for tests for sends
# see  $ARCHBUILDS/build-scripts/27-mail.sh  &  $email/nm-config-template

#=> backup my Mutt Wizard files
alias mwb='bash $email/mwBackup.sh'

#=> find mutt aliases
maf () {
    fAt=$maild/$account/foundAliasesTemp
    # $maild  is defined in  $ARCHBUILDS/Bash/export-storage
    notmuch show tag:$account > $fAt
    sed -Ei '/(^Cc|^From|^To):/!d' $fAt  # clear out all but addresses
    sed -Ei 's/(^Cc|^From|^To)://' $fAt  # remove directions
    sed -i 's/ $//' $fAt  # remove trailing space
    sed -Ei '/"[[:alnum:]]+,/ s/,//' $fAt  # remove comma in name
    sed -Ei 's/, /\n/g' $fAt  # newline all emails
    sed -i '/^[[:space:]]*$/d' $fAt  # removes empty lines
    sed -Ei 's/^[ \t]+//' $fAt  # removes leading whitespace
    sed -i 's/^/alias /' $fAt  # prefix, ready to sort
    fA=$maild/$account/foundAliases
    echo "# vim: set ft=muttaliases:" > $fA
    echo "" >> $fA
    sort -u $fAt >> $fA  # save as a rough collection, sorted
    rm $fAt
}
maff (){ account=fm;   maf; }
mafx (){ account=gmx;  maf; }
mafl (){ account=live; maf; }
maft (){ account=troh; maf; }

#=> neomutt
alias nmf='neomutt -F $email/muttrc-account_ftml'
alias nmj='neomutt -F $email/muttrc-account_tj'
alias nml='neomutt -F $email/muttrc-account_live'
alias nmp='neomutt -F $email/muttrc-account_parl'
alias nmt='neomutt -F $email/muttrc-account_troh'
alias nmx='neomutt -F $email/muttrc-account_gmx'
alias nmz='neomutt -F $email/muttrc-account_cz'

#=> notmuch search
nmse () {
    notmuchsearch="$@"
    echo $notmuchsearch
    notmuch search $notmuchsearch
} # gets a quick list of the relevant emails
# nmse bloch date:2021
nmsh () {
    echo '# vim: set ft=mail tw=0:' > nms
    echo >> nms
    echo -en "\e[92m  saving last nmse in nms.mail\n"
    notmuch show $notmuchsearch >> nms
    sed -i 's#message}#message}\n#' nms  # adds space after each message
    tac nms | sed '/Date: /{h;d;};/message{/G' | tac > nms.mail  # moves date to start of message
    rm nms
    sed -i '//d' nms.mail  # finally remove unneeded lines
    perl $email/nmsh-sort.pl nms.mail
    [[ $DISPLAY ]] && gvc nms.mail # open it in gVim only if safe to do so
} # shows the relevant emails

#=> sync & tag mail
[[ -d $LE ]] && source $LE/emailAddresses

nmnew () { echo "notmuch new:"; notmuch new; } # see $email/nm-config-template

# see $email/mbsyncrc-template
msf () { mbsync fm   ; nmnew ; echo "nmTags-fm.sh"   ; bash $email/nmTags-fm.sh   ; }
msj () { mbsync tj   ; nmnew ; echo "nmTags-tj.sh"   ; bash $email/nmTags-tj.sh   ; }
msl () { mbsync live ; nmnew ; echo "nmTags-live.sh" ; bash $email/nmTags-live.sh ; }
msp () { mbsync parl ; nmnew ; echo "nmTags-parl.sh" ; bash $email/nmTags-parl.sh ; }
mst () { mbsync troh ; nmnew ; echo "nmTags-troh.sh" ; bash $email/nmTags-troh.sh ; }
msx () { mbsync gmx  ; nmnew ; echo "nmTags-gmx.sh"  ; bash $email/nmTags-gmx.sh  ; }
msz () { mbsync cz   ; nmnew ; echo "nmTags-cz.sh"   ; bash $email/nmTags-cz.sh   ; }

alias ms='
echo -e "${tpf2b}-- fm   --${tpfn}"; msf;
echo -e "${tpf2b}-- tj   --${tpfn}"; msj;
echo -e "${tpf2b}-- live --${tpfn}"; msl;
echo -e "${tpf2b}-- parl --${tpfn}"; msp;
echo -e "${tpf2b}-- troh --${tpfn}"; mst;
echo -e "${tpf2b}-- gmx  --${tpfn}"; msx;
echo -e "${tpf2b}-- cz   --${tpfn}"; msz;
'

